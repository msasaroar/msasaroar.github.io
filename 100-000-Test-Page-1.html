<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GA4 Checkout Demo</title>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-XXXXXXXXXX');
    </script>
</head>
<body>
    <header>
        <h1>GA4 Checkout Demo</h1>
    </header>

    <main>
        <!-- Product Listing -->
        <section id="product-list">
            <h2>Products</h2>
            <div class="product" data-id="p1" data-name="Product 1" data-price="25.00">
                <h3>Product 1</h3>
                <p>Price: $25.00</p>
                <button class="add-to-cart">Add to Cart</button>
            </div>
            <div class="product" data-id="p2" data-name="Product 2" data-price="50.00">
                <h3>Product 2</h3>
                <p>Price: $50.00</p>
                <button class="add-to-cart">Add to Cart</button>
            </div>
        </section>

        <!-- Cart -->
        <section id="cart">
            <h2>Shopping Cart</h2>
            <ul id="cart-items"></ul>
            <p id="total-price">Total: $0.00</p>
            <button id="checkout">Proceed to Checkout</button>
        </section>

        <!-- Checkout Form -->
        <section id="checkout-form" style="display:none;">
            <h2>Checkout</h2>
            <form id="checkout-process">
                <label for="name">Name:</label>
                <input type="text" id="name" name="name" required>

                <label for="address">Address:</label>
                <input type="text" id="address" name="address" required>

                <button type="submit">Place Order</button>
            </form>
        </section>
    </main>

    <script>
        // Tracking Add to Cart Events
        document.querySelectorAll('.add-to-cart').forEach(button => {
            button.addEventListener('click', function() {
                const product = this.parentElement;
                const id = product.dataset.id;
                const name = product.dataset.name;
                const price = product.dataset.price;

                gtag('event', 'add_to_cart', {
                    currency: 'USD',
                    items: [{
                        item_id: id,
                        item_name: name,
                        price: parseFloat(price)
                    }]
                });

                addToCart(id, name, parseFloat(price));
            });
        });

        // Updating Cart and Checkout
        const cartItems = [];
        const cartList = document.getElementById('cart-items');
        const totalPriceElement = document.getElementById('total-price');

        function addToCart(id, name, price) {
            cartItems.push({ id, name, price });
            updateCart();
        }

        function updateCart() {
            cartList.innerHTML = '';
            let total = 0;

            cartItems.forEach(item => {
                const li = document.createElement('li');
                li.textContent = `${item.name} - $${item.price.toFixed(2)}`;
                cartList.appendChild(li);
                total += item.price;
            });

            totalPriceElement.textContent = `Total: $${total.toFixed(2)}`;
        }

        // Proceed to Checkout
        document.getElementById('checkout').addEventListener('click', () => {
            document.getElementById('cart').style.display = 'none';
            document.getElementById('checkout-form').style.display = 'block';
        });

        // Tracking Checkout Events
        document.getElementById('checkout-process').addEventListener('submit', (e) => {
            e.preventDefault();
            gtag('event', 'purchase', {
                currency: 'USD',
                transaction_id: 'T12345',
                value: cartItems.reduce((total, item) => total + item.price, 0),
                items: cartItems.map(item => ({
                    item_id: item.id,
                    item_name: item.name,
                    price: item.price
                }))
            });

            alert('Order placed successfully!');
            location.reload();
        });
    </script>
</body>
</html>
